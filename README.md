# Infrastructure as Code Example

This is a super basic example for Infrastructure as Code used in a
course at Yrgo. This is not intended to be used on its own or
as a basis for any real world project.

## Running

For running this outside of the containerized world you need to do the
following:

* Have a MySQL 8 database server running.
* Have a database named "hsdb".
* Build and run the backend service using Maven and Java 11+.
* Build and run the frontend service using Node.js 18+.
* Connect them with the proxy program to make them come from the same origin.

The backend service requires the following environment variables to be set:

* DB_HOST - hostname of the MySQL server.
* DB_USERNAME - username for the MySQL server.
* DB_PASSWORD - password for the MySQL user.

These need to be available at compile time since part of the program is
generated by JOOQ.

Generate the database schema with `mvn flyway:migrate`.

Build the backend service using Maven: `mvn compile`.

Run the backend service using Maven: `mvn exec:java`.

Build and run the frontend service with Node.js and Vite:

```
npm install
npm run dev
```

Start the proxy from the `proxy`-directory with:

```
npm install
node index.js
```

The proxy just makes sure to run the backend and frontend from the same origin
to keep things simple.

## Build images

Both the frontend and backend needs the following environment variable set:

* DOCKER_REGISTRY - hostname (and port) of the Docker registry to use.

The backend will build and push itself on `mvn package` to the image `hsbackend`.

The frontend will build and push itself with the shell script `build-docker.sh`.


## Infrastructure as Code

The complete system can be deployed in Docker using either Terraform or
Docker Compose. These setups are of course very simplistic. Currently both
assume that you are using a local Docker repository.

### Terraform

In the `terraform` directory run:

```
terraform init
terraform apply
```

### Docker Compose

In the `docker-compose`-directory run:

```
docker compose up
```
